# 📊 TradingAgents 架構研究筆記

> 研究日期：2026-02-05
> 來源：https://github.com/TauricResearch/TradingAgents
> 目的：學習多 Agent 交易決策架構，應用於 Lucy 的分析流程

---

## 🏗️ 核心架構

```
                    ┌─────────────────┐
                    │   Input: 股票   │
                    │   + 日期        │
                    └────────┬────────┘
                             │
              ┌──────────────┼──────────────┐
              ▼              ▼              ▼
        ┌──────────┐  ┌──────────┐  ┌──────────┐
        │ 基本面   │  │ 技術面   │  │ 情緒面   │
        │ 分析師   │  │ 分析師   │  │ 分析師   │
        └────┬─────┘  └────┬─────┘  └────┬─────┘
             │             │             │
             └──────────┬──┴─────────────┘
                        ▼
              ┌─────────────────┐
              │   新聞分析師    │
              └────────┬────────┘
                       │
         ┌─────────────┴─────────────┐
         ▼                           ▼
   ┌───────────┐              ┌───────────┐
   │ 多頭研究員│◄────辯論────►│ 空頭研究員│
   └─────┬─────┘              └─────┬─────┘
         │                         │
         └───────────┬─────────────┘
                     ▼
              ┌─────────────┐
              │   交易員    │
              │  (綜合決策) │
              └──────┬──────┘
                     ▼
              ┌─────────────┐
              │   風控團隊  │
              │  (審核把關) │
              └──────┬──────┘
                     ▼
              ┌─────────────┐
              │  最終決策   │
              │ BUY/HOLD/   │
              │ SELL        │
              └─────────────┘
```

---

## 📚 各 Agent 職責

### 1. 分析師團隊 (Analysts)

#### 基本面分析師 (Fundamentals Analyst)
```python
tools = [
    get_fundamentals,      # 公司概況
    get_balance_sheet,     # 資產負債表
    get_cashflow,          # 現金流量表
    get_income_statement,  # 損益表
]
```
**輸出**：財務報告 + Markdown 表格整理重點

#### 技術面分析師 (Market Analyst)
```python
tools = [
    get_stock_data,    # 股價數據
    get_indicators,    # 技術指標 (MACD, RSI, etc.)
]
```
**輸出**：技術分析報告，趨勢判斷

#### 情緒分析師 (Social Media Analyst)
**輸出**：社群媒體情緒評分，市場氣氛

#### 新聞分析師 (News Analyst)
```python
tools = [
    get_news,          # 公司新聞
    get_global_news,   # 全球財經新聞
]
```
**輸出**：新聞摘要，事件影響分析

---

### 2. 研究員辯論 (Researchers Debate)

這是架構中最有趣的部分！

#### 多頭研究員 (Bull Researcher)
**角色**：為投資該股票辯護
**輸入**：
- 所有分析師報告
- 辯論歷史
- 空頭的上一輪論點
- 過去類似情況的經驗記憶

**策略**：
- 強調成長潛力
- 凸顯競爭優勢
- 反駁空頭論點

#### 空頭研究員 (Bear Researcher)
**角色**：質疑投資該股票
**策略**：
- 指出風險因素
- 質疑估值
- 挑戰樂觀假設

#### 辯論機制
```python
# 辯論迴圈
for round in range(max_debate_rounds):
    bull_argument = bull_researcher(state)
    bear_argument = bear_researcher(state)
    # 累積辯論歷史
    state["investment_debate_state"]["history"] += bull_argument + bear_argument
```

**關鍵設計**：
- `max_debate_rounds`：控制辯論次數（預設 1-2 輪）
- 每輪都能看到對方論點並回應
- 辯論歷史會傳給交易員參考

---

### 3. 交易員 (Trader)

**輸入**：
- 所有分析師報告
- 研究員辯論結論
- 過去類似情況的決策記憶

**輸出**：
```
FINAL TRANSACTION PROPOSAL: **BUY/HOLD/SELL**
+ 詳細理由
```

---

### 4. 風控團隊 (Risk Management)

**職責**：
- 評估市場波動性
- 檢查流動性風險
- 調整倉位建議

**最終審核**：
- APPROVE → 執行交易
- REJECT → 駁回提案

---

## 🧠 記憶系統 (Memory)

每個關鍵 Agent 都有獨立記憶：
```python
self.bull_memory = FinancialSituationMemory("bull_memory")
self.bear_memory = FinancialSituationMemory("bear_memory")
self.trader_memory = FinancialSituationMemory("trader_memory")
```

**用途**：
- 儲存過去類似情況的分析和決策
- 提取相關經驗作為參考
- 從錯誤中學習

---

## 💡 可借鏡的設計模式

### 模式 1：多視角分析
不要只從單一角度看問題，而是：
- 基本面：公司值不值這個價？
- 技術面：現在買入時機好不好？
- 情緒面：市場怎麼看？
- 新聞面：有什麼催化劑？

### 模式 2：對抗性辯論
強制從正反兩面思考：
- 為什麼應該買？（多頭論點）
- 為什麼不應該買？（空頭論點）
- 哪邊的論點更有說服力？

### 模式 3：風控把關
決策前的最後一道防線：
- 這個決策的風險可接受嗎？
- 有沒有考慮最壞情況？

### 模式 4：經驗記憶
- 記錄每次決策和結果
- 遇到類似情況時提取參考
- 避免重複犯錯

---

## 🎯 Lucy 的應用計畫

### 階段 1：內部多視角分析
當被問股票時，我會：
1. 蒐集基本面數據（營收、EPS、本益比）
2. 查看技術指標（K線、均線、RSI）
3. 搜尋近期新聞和市場情緒
4. 整合成多維度報告

### 階段 2：內部辯論機制
```
[多頭觀點]
- 列出 3 個看多的理由
- 用數據支持

[空頭觀點]
- 列出 3 個風險因素
- 質疑多頭假設

[綜合判斷]
- 哪邊更有說服力？
- 最終建議 + 信心度
```

### 階段 3：風險提醒
每個建議都附上：
- 支撐位 / 壓力位
- 停損建議
- 風險等級 (高/中/低)

### 階段 4：決策追蹤
記錄每次分析：
- 日期、標的、建議
- 後續追蹤結果
- 經驗教訓

---

## 📝 Prompt 範本

### 多頭分析 Prompt
```
你是多頭分析師，請為投資 {股票} 辯護。

參考資料：
- 基本面：{fundamentals}
- 技術面：{technicals}
- 新聞：{news}

請提出 3 個看多理由，並用數據支持。
針對可能的質疑，預先準備反駁論點。
```

### 空頭分析 Prompt
```
你是空頭分析師，請質疑投資 {股票} 的決定。

參考資料：（同上）

請指出 3 個主要風險，並說明：
- 這些風險發生的可能性
- 發生後的影響程度
- 多頭論點的漏洞
```

### 綜合決策 Prompt
```
基於以上多空辯論，請做出最終判斷：

多頭論點摘要：{bull_summary}
空頭論點摘要：{bear_summary}

請回答：
1. 哪邊的論點更有說服力？為什麼？
2. 最終建議：買入 / 持有 / 賣出
3. 信心度：高 / 中 / 低
4. 關鍵風險提醒
```

---

## 🔗 參考資源

- 論文：https://arxiv.org/abs/2412.20138
- GitHub：https://github.com/TauricResearch/TradingAgents
- 使用的技術：LangGraph, LangChain

---

*Made with ✨ by Lucy | 2026-02-05*
