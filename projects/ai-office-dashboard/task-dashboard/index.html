<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lucy ä»»å‹™ç®¡ç†ç³»çµ± âœ¨</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Noto Sans TC', sans-serif; }
    .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
    .card { backdrop-filter: blur(10px); background: rgba(255,255,255,0.95); }
    .task-card:hover { transform: translateY(-2px); box-shadow: 0 10px 40px rgba(0,0,0,0.1); }
    .status-dot { width: 8px; height: 8px; border-radius: 50%; }
    .pulse { animation: pulse 2s infinite; }
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
  </style>
</head>
<body class="min-h-screen gradient-bg">
  <!-- Header -->
  <header class="bg-white/10 backdrop-blur-md border-b border-white/20">
    <div class="max-w-7xl mx-auto px-4 py-4 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <span class="text-3xl">âœ¨</span>
        <div>
          <h1 class="text-xl font-bold text-white">Lucy ä»»å‹™ç®¡ç†ç³»çµ±</h1>
          <p class="text-white/70 text-sm">Vince çš„ AI åŠ©ç†å·¥ä½œè¿½è¹¤</p>
        </div>
      </div>
      <div class="flex items-center gap-4">
        <div class="flex items-center gap-2 text-white/80 text-sm">
          <span class="status-dot bg-green-400 pulse"></span>
          <span>Lucy åœ¨ç·šä¸­</span>
        </div>
        <button onclick="loadTasks()" class="px-4 py-2 bg-white/20 hover:bg-white/30 text-white rounded-lg transition">
          ğŸ”„ é‡æ–°æ•´ç†
        </button>
      </div>
    </div>
  </header>

  <main class="max-w-7xl mx-auto px-4 py-8">
    <!-- Stats Cards -->
    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
      <div class="card rounded-2xl p-4 shadow-lg">
        <div class="text-3xl mb-2">ğŸ“Œ</div>
        <div class="text-2xl font-bold text-gray-800" id="stat-active">0</div>
        <div class="text-gray-500 text-sm">é€²è¡Œä¸­ä»»å‹™</div>
      </div>
      <div class="card rounded-2xl p-4 shadow-lg">
        <div class="text-3xl mb-2">âœ…</div>
        <div class="text-2xl font-bold text-gray-800" id="stat-completed">0</div>
        <div class="text-gray-500 text-sm">å·²å®Œæˆ</div>
      </div>
      <div class="card rounded-2xl p-4 shadow-lg">
        <div class="text-3xl mb-2">ğŸ“š</div>
        <div class="text-2xl font-bold text-gray-800" id="stat-learning">0</div>
        <div class="text-gray-500 text-sm">å­¸ç¿’é …ç›®</div>
      </div>
      <div class="card rounded-2xl p-4 shadow-lg">
        <div class="text-3xl mb-2">ğŸ¯</div>
        <div class="text-2xl font-bold text-gray-800" id="stat-rate">0%</div>
        <div class="text-gray-500 text-sm">å®Œæˆç‡</div>
      </div>
    </div>

    <!-- Add Task Button -->
    <div class="mb-6">
      <button onclick="openAddModal()" class="px-6 py-3 bg-white text-purple-600 font-medium rounded-xl shadow-lg hover:shadow-xl transition flex items-center gap-2">
        <span class="text-xl">â•</span> æŒ‡æ´¾æ–°ä»»å‹™çµ¦ Lucy
      </button>
    </div>

    <!-- Task Sections -->
    <div class="grid md:grid-cols-2 gap-6">
      <!-- Urgent Tasks -->
      <div class="card rounded-2xl p-6 shadow-lg">
        <h2 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
          <span class="w-3 h-3 rounded-full bg-red-500"></span>
          ğŸ”´ ç·Šæ€¥ä»»å‹™
        </h2>
        <div id="urgent-tasks" class="space-y-3">
          <p class="text-gray-400 text-sm">æš«ç„¡ç·Šæ€¥ä»»å‹™</p>
        </div>
      </div>

      <!-- Important Tasks -->
      <div class="card rounded-2xl p-6 shadow-lg">
        <h2 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
          <span class="w-3 h-3 rounded-full bg-yellow-500"></span>
          ğŸŸ¡ é‡è¦ä»»å‹™
        </h2>
        <div id="important-tasks" class="space-y-3">
          <p class="text-gray-400 text-sm">æš«ç„¡é‡è¦ä»»å‹™</p>
        </div>
      </div>

      <!-- Normal Tasks -->
      <div class="card rounded-2xl p-6 shadow-lg">
        <h2 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
          <span class="w-3 h-3 rounded-full bg-green-500"></span>
          ğŸŸ¢ ä¸€èˆ¬ä»»å‹™
        </h2>
        <div id="normal-tasks" class="space-y-3">
          <p class="text-gray-400 text-sm">æš«ç„¡ä¸€èˆ¬ä»»å‹™</p>
        </div>
      </div>

      <!-- Long-term Tasks -->
      <div class="card rounded-2xl p-6 shadow-lg">
        <h2 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
          <span class="w-3 h-3 rounded-full bg-blue-500"></span>
          ğŸ”µ é•·æœŸä»»å‹™
        </h2>
        <div id="longterm-tasks" class="space-y-3">
          <p class="text-gray-400 text-sm">æš«ç„¡é•·æœŸä»»å‹™</p>
        </div>
      </div>
    </div>

    <!-- Learning Section -->
    <div class="mt-6 card rounded-2xl p-6 shadow-lg">
      <h2 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
        ğŸ“š Lucy çš„å­¸ç¿’è¨ˆç•«
      </h2>
      <div class="grid md:grid-cols-2 gap-6">
        <div>
          <h3 class="font-medium text-gray-600 mb-3">ğŸ“ å­¸ç¿’ä¸­</h3>
          <div id="learning-tasks" class="space-y-3">
            <p class="text-gray-400 text-sm">æš«ç„¡å­¸ç¿’ä¸­é …ç›®</p>
          </div>
        </div>
        <div>
          <h3 class="font-medium text-gray-600 mb-3">ğŸ“‹ å¾…å­¸ç¿’æ¸…å–®</h3>
          <div id="learning-queue" class="space-y-3">
            <p class="text-gray-400 text-sm">æš«ç„¡å¾…å­¸ç¿’é …ç›®</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Completed Tasks -->
    <div class="mt-6 card rounded-2xl p-6 shadow-lg">
      <h2 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
        âœ… å·²å®Œæˆä»»å‹™
      </h2>
      <div id="completed-tasks" class="space-y-2">
        <p class="text-gray-400 text-sm">æš«ç„¡å·²å®Œæˆä»»å‹™</p>
      </div>
    </div>
  </main>

  <!-- Add Task Modal -->
  <div id="add-modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm hidden items-center justify-center z-50">
    <div class="bg-white rounded-2xl p-6 w-full max-w-md mx-4 shadow-2xl">
      <h3 class="text-xl font-bold text-gray-800 mb-4">â• æŒ‡æ´¾æ–°ä»»å‹™çµ¦ Lucy</h3>
      
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-gray-600 mb-1">ä»»å‹™åç¨±</label>
          <input type="text" id="task-name" class="w-full px-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" placeholder="è«‹è¼¸å…¥ä»»å‹™å…§å®¹...">
        </div>
        
        <div>
          <label class="block text-sm font-medium text-gray-600 mb-1">å„ªå…ˆç´š</label>
          <select id="task-priority" class="w-full px-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-purple-500">
            <option value="urgent">ğŸ”´ ç·Šæ€¥ï¼ˆä»Šå¤©è¦å®Œæˆï¼‰</option>
            <option value="important" selected>ğŸŸ¡ é‡è¦ï¼ˆæœ¬é€±å…§ï¼‰</option>
            <option value="normal">ğŸŸ¢ ä¸€èˆ¬ï¼ˆæœ‰ç©ºå†åšï¼‰</option>
            <option value="longterm">ğŸ”µ é•·æœŸï¼ˆæŒçºŒé€²è¡Œï¼‰</option>
          </select>
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-600 mb-1">æˆªæ­¢æ—¥æœŸï¼ˆé¸å¡«ï¼‰</label>
          <input type="date" id="task-deadline" class="w-full px-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-purple-500">
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-600 mb-1">å‚™è¨»ï¼ˆé¸å¡«ï¼‰</label>
          <textarea id="task-note" rows="2" class="w-full px-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-purple-500" placeholder="é¡å¤–èªªæ˜..."></textarea>
        </div>
      </div>

      <div class="flex gap-3 mt-6">
        <button onclick="closeAddModal()" class="flex-1 px-4 py-2 border border-gray-200 text-gray-600 rounded-lg hover:bg-gray-50 transition">
          å–æ¶ˆ
        </button>
        <button onclick="addTask()" class="flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition">
          æ–°å¢ä»»å‹™
        </button>
      </div>
    </div>
  </div>

  <script>
    let tasksData = null;

    // Load tasks from server
    async function loadTasks() {
      try {
        const res = await fetch('/api/tasks');
        tasksData = await res.json();
        renderTasks();
        updateStats();
      } catch (err) {
        console.error('è¼‰å…¥å¤±æ•—:', err);
      }
    }

    // Render tasks to UI
    function renderTasks() {
      renderSection('urgent-tasks', tasksData.urgent);
      renderSection('important-tasks', tasksData.important);
      renderSection('normal-tasks', tasksData.normal);
      renderSection('longterm-tasks', tasksData.longterm);
      renderSection('learning-tasks', tasksData.learning);
      renderSection('learning-queue', tasksData.learningQueue);
      renderCompleted();
    }

    function renderSection(elementId, tasks) {
      const container = document.getElementById(elementId);
      if (!tasks || tasks.length === 0 || (tasks.length === 1 && tasks[0].name === '-')) {
        container.innerHTML = '<p class="text-gray-400 text-sm">æš«ç„¡ä»»å‹™</p>';
        return;
      }

      container.innerHTML = tasks.filter(t => t.name !== '-').map(task => `
        <div class="task-card bg-gray-50 rounded-xl p-4 transition cursor-pointer hover:bg-gray-100">
          <div class="flex items-start justify-between">
            <div class="flex-1">
              <div class="font-medium text-gray-800">${task.name}</div>
              ${task.note && task.note !== '-' ? `<div class="text-sm text-gray-500 mt-1">${task.note}</div>` : ''}
              ${task.deadline && task.deadline !== '-' ? `<div class="text-xs text-gray-400 mt-2">ğŸ“… ${task.deadline}</div>` : ''}
            </div>
            <span class="text-lg">${getStatusEmoji(task.status)}</span>
          </div>
        </div>
      `).join('');
    }

    function renderCompleted() {
      const container = document.getElementById('completed-tasks');
      const tasks = tasksData.completed;
      
      if (!tasks || tasks.length === 0 || (tasks.length === 1 && tasks[0].name === '-')) {
        container.innerHTML = '<p class="text-gray-400 text-sm">æš«ç„¡å·²å®Œæˆä»»å‹™</p>';
        return;
      }

      container.innerHTML = tasks.filter(t => t.name !== '-').map(task => `
        <div class="flex items-center gap-3 py-2 border-b border-gray-100 last:border-0">
          <span class="text-green-500">âœ…</span>
          <span class="text-gray-600">${task.name}</span>
          <span class="text-gray-400 text-sm ml-auto">${task.status || ''}</span>
        </div>
      `).join('');
    }

    function getStatusEmoji(status) {
      if (status.includes('âœ…') || status.includes('å®Œæˆ')) return 'âœ…';
      if (status.includes('ğŸ”„') || status.includes('é€²è¡Œ')) return 'ğŸ”„';
      if (status.includes('â¸ï¸') || status.includes('æš«åœ')) return 'â¸ï¸';
      return 'â¬œ';
    }

    function updateStats() {
      const active = countTasks(['urgent', 'important', 'normal', 'longterm']);
      const completed = countTasks(['completed']);
      const learning = countTasks(['learning', 'learningQueue']);
      const total = active + completed;
      const rate = total > 0 ? Math.round((completed / total) * 100) : 0;

      document.getElementById('stat-active').textContent = active;
      document.getElementById('stat-completed').textContent = completed;
      document.getElementById('stat-learning').textContent = learning;
      document.getElementById('stat-rate').textContent = rate + '%';
    }

    function countTasks(sections) {
      return sections.reduce((sum, section) => {
        const tasks = tasksData[section] || [];
        return sum + tasks.filter(t => t.name !== '-').length;
      }, 0);
    }

    // Modal functions
    function openAddModal() {
      document.getElementById('add-modal').classList.remove('hidden');
      document.getElementById('add-modal').classList.add('flex');
    }

    function closeAddModal() {
      document.getElementById('add-modal').classList.add('hidden');
      document.getElementById('add-modal').classList.remove('flex');
      // Clear form
      document.getElementById('task-name').value = '';
      document.getElementById('task-deadline').value = '';
      document.getElementById('task-note').value = '';
    }

    async function addTask() {
      const name = document.getElementById('task-name').value.trim();
      const priority = document.getElementById('task-priority').value;
      const deadline = document.getElementById('task-deadline').value;
      const note = document.getElementById('task-note').value.trim();

      if (!name) {
        alert('è«‹è¼¸å…¥ä»»å‹™åç¨±');
        return;
      }

      const today = new Date().toISOString().split('T')[0];
      const newTask = {
        name: name,
        status: 'â¬œ',
        date: today,
        deadline: deadline || '-',
        note: note || '-'
      };

      // Add to appropriate section
      if (!tasksData[priority]) tasksData[priority] = [];
      // Remove placeholder if exists
      tasksData[priority] = tasksData[priority].filter(t => t.name !== '-');
      tasksData[priority].push(newTask);

      // Save to server
      try {
        await fetch('/api/tasks', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(tasksData)
        });
        closeAddModal();
        loadTasks();
      } catch (err) {
        alert('å„²å­˜å¤±æ•—: ' + err.message);
      }
    }

    // Initialize
    loadTasks();
    // Auto refresh every 30 seconds
    setInterval(loadTasks, 30000);
  </script>
</body>
</html>
